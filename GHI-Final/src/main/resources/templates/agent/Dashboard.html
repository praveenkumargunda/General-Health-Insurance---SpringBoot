<!DOCTYPE html>
<html lang="en" xmlns:th="http://www.thymeleaf.org">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Agent Dashboard - Resilience India Insurance</title>
    <link href="https://cdnjs.cloudflare.com/ajax/libs/bootstrap/5.3.2/css/bootstrap.min.css" rel="stylesheet">
    <link href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.0.0/css/all.min.css" rel="stylesheet">
    <style>
        body { background: #f8f9fb; font-family: 'Segoe UI', Tahoma, Geneva, Verdana, sans-serif; }
        .navbar { background: linear-gradient(135deg, #5a67d8 0%, #764ba2 100%); }
        .navbar-brand { font-size: 1.5rem; font-weight: 700; color: white !important; }
        .sidebar { background: white; min-height: 100vh; box-shadow: 2px 0 10px rgba(0, 0, 0, 0.05); }
        .sidebar .nav-link { color: #495057; padding: 15px 20px; border-left: 3px solid transparent; }
        .sidebar .nav-link:hover, .sidebar .nav-link.active { background: #f8f9fa; color: #5a67d8; border-left-color: #5a67d8; }
        .main-content { padding: 2rem; }
        .content-section { display: none; }
        .content-section.active { display: block; }
        .customer-table th { background: #5a67d8; color: white; }

        /* Gradient button */
        .btn-gradient {
            background: linear-gradient(135deg, #5a67d8, #764ba2);
            color: #fff;
            border: none;
            padding: 0.5rem 1rem;
            border-radius: 10px;
            font-weight: 500;
            transition: 0.3s ease;
        }
        .btn-gradient:hover {
            background: linear-gradient(135deg, #4c51bf, #6b46c1);
            color: #fff;
        }

        /* Greeting card */
		.greeting-card {
		    background: linear-gradient(135deg, #d6b4fc, #b39ddb); /* light violet shades */
		    color: #333; /* darker text, since background is lighter */
		    border-radius: 15px;
		    padding: 2rem;
		    margin-top: 1rem;
		    margin-bottom: 4rem;
		    box-shadow: 0 6px 18px rgba(0,0,0,0.15);
		}


        /* Stat cards smaller + equal height */
        .stat-card {
            border-radius: 12px;
            height: 100%;
            padding: 1.5rem 1rem;
            transition: 0.3s ease;
        }
        .stat-card:hover {
            transform: translateY(-3px);
            box-shadow: 0 6px 16px rgba(0,0,0,0.15);
        }
        .stat-card h3 {
            font-size: 1.8rem;
            margin: 0.5rem 0;
        }
        .stat-card p {
            font-size: 0.95rem;
            margin-bottom: 1rem;
        }

		/* Profile improvements */
		        #profileView .card {
		            border-radius: 12px;
		            background: white;
		            padding: 2rem;
		        }

		        /* Avatar with initials */
		        .profile-avatar {
		            width: 120px;
		            height: 120px;
		            border-radius: 50%;
		            background: linear-gradient(135deg, #667eea, #764ba2);
		            display: flex;
		            align-items: center;
		            justify-content: center;
		            font-size: 2.5rem;
		            font-weight: 700;
		            color: white;
		            margin: 0 auto 1rem auto;
		        }

		        /* Profile Info styled boxes */
		        .info-box {
		            background: #f8f9fa;
		            border: 1px solid #e1e5ee;
		            border-radius: 8px;
		            padding: 12px 15px;
		            margin-bottom: 12px;
		        }
		        .info-box strong {
		            display: block;
		            font-size: 0.9rem;
		            color: #6c757d;
		            margin-bottom: 4px;
		        }
		        .info-box span {
		            font-size: 1rem;
		            font-weight: 500;
		            color: #333;
		        }

    </style>
</head>
<body>
	
	<!-- Floating Success Message (top-right corner) -->
	<div id="successMessage"
	     class="alert alert-success shadow-sm"
	     style="position: fixed; top: 20px; right: 20px; display: none; 
	            z-index: 1050; min-width: 250px; border-radius: 8px; padding: 10px 15px;">
	</div>

<!-- Navbar -->
<nav class="navbar navbar-expand-lg navbar-dark sticky-top">
    <div class="container-fluid">
        <a class="navbar-brand" th:href="@{/agent/dashboard}">
            <i class="fas fa-shield-alt me-2"></i> Resilience India
            <span class="badge bg-success ms-2">Agent</span>
        </a>
        <div class="collapse navbar-collapse">
            <div class="navbar-nav ms-auto d-flex align-items-center">
                <i class="fas fa-bell nav-notification text-white me-3"></i>
                <div class="dropdown">
                    <a class="nav-link dropdown-toggle text-white" href="#" role="button" data-bs-toggle="dropdown">
                        <i class="fas fa-user-circle"></i> <span th:text="${agent.firstName}">Agent</span>
                    </a>
                    <ul class="dropdown-menu dropdown-menu-end">
                        <li><a class="dropdown-item" href="#" onclick="showSection('profileContent')"><i class="fas fa-user me-2"></i>Profile</a></li>
                        <li><hr class="dropdown-divider"></li>
                        <li><a class="dropdown-item" th:href="@{/agent/web/logout}"><i class="fas fa-sign-out-alt me-2"></i>Logout</a></li>
                    </ul>
                </div>
            </div>
        </div>
    </div>
</nav>

<div class="container-fluid">
    <div class="row">
        <!-- Sidebar -->
        <div class="col-md-3 col-lg-2 px-0">
            <div class="sidebar">
                <nav class="nav flex-column">
                    <a class="nav-link active" href="#" onclick="showSection('dashboardContent')"><i class="fas fa-tachometer-alt me-2"></i>Dashboard</a>
                    <a class="nav-link" href="#" onclick="showSection('customersContent')"><i class="fas fa-users me-2"></i>My Customers</a>
                    <a class="nav-link" href="#" onclick="showSection('profileContent')"><i class="fas fa-user me-2"></i>Profile</a>
                    <a class="nav-link" href="#" onclick="showSection('createPolicyContent')"><i class="fas fa-file-alt me-2"></i>Create Policies</a>
                    <a class="nav-link" href="#" onclick="showSection('buyPolicyContent')"><i class="fas fa-shopping-cart me-2"></i>Buy Policies</a>
                    <a class="nav-link" href="#" onclick="showSection('paymentHistoryContent')"><i class="fas fa-wallet me-2"></i>Payment History</a>
                </nav>
            </div>
        </div>

        <!-- Main Content -->
        <div class="col-md-9 col-lg-10">
            <div class="main-content">

                <!-- Dashboard -->
                <div id="dashboardContent" class="content-section active">

                    <!-- Date & Time -->
                    <div class="d-flex justify-content-end align-items-center mb-3">
                        <i class="fas fa-calendar-alt me-2 text-secondary"></i>
                        <span id="currentDateTime" style="font-weight:bold; font-size:14px; margin-right:10px;"></span>
                    </div>

                    <!-- Greeting -->
                    <div class="greeting-card">
                        <h3 class="fw-bold mb-2">Hi, <span th:text="${agent.firstName}">Aparna</span> üëã</h3>
                        <p class="mb-0">Welcome back! Manage your customers, create policies, and track everything in one place.</p>
                    </div>
					
					


                    <!-- Stat Cards -->
                    <div class="row g-4">
                        <!-- Customers -->
                        <div class="col-md-3">
                            <div class="card stat-card text-center shadow-sm border-0">
                                <i class="fas fa-users fa-2x text-primary mb-2"></i>
                                <h3 th:text="${totalCustomers != null ? totalCustomers : 0}">0</h3>
                                <p class="text-muted">Assigned Customers</p>
                                <a href="#" onclick="showSection('customersContent')" class="btn btn-gradient">View</a>
                            </div>
                        </div>
                        <!-- Create Policies -->
                        <div class="col-md-3">
                            <div class="card stat-card text-center shadow-sm border-0">
                                <i class="fas fa-file-alt fa-2x text-success mb-2"></i>
								<h3 class="fw-bold text-muted">üìù</h3>


                               <p class="text-muted">Policies Created</p>
                                <a href="#" onclick="showSection('createPolicyContent')" class="btn btn-gradient">Create</a>
                            </div>
                        </div>
                        <!-- Buy Policies -->
                        <div class="col-md-3">
                            <div class="card stat-card text-center shadow-sm border-0">
                                <i class="fas fa-shopping-cart fa-2x text-info mb-2"></i>
								<h3 class="fw-bold text-muted">üåü</h3>
                                <p class="text-muted">Buy Policies</p>
                                <a th:href="@{/agent/purchase/policies}" class="btn btn-gradient">Buy</a>
                            </div>
                        </div>
                        <!-- Payment History -->
                        <div class="col-md-3">
                            <div class="card stat-card text-center shadow-sm border-0">
                                <i class="fas fa-wallet fa-2x text-warning mb-2"></i>
								<h3 class="fw-bold text-muted">‚úÖ</h3>
                                <p class="text-muted">Payment History</p>
                                <a th:href="@{/history}" class="btn btn-gradient">View</a>
                            </div>
                        </div>
                    </div>
                </div>

				<!-- Profile -->
				               <div id="profileContent" class="content-section">
								<h2 class="mb-4">My Profile</h2>
								   
								   <!-- üîΩ PLACE THIS BLOCK HERE -->
								   <div th:if="${param.success}" 
								        class="alert alert-success alert-dismissible fade show mt-3" role="alert">
								       <span th:text="${param.success}"></span>
								       <button type="button" class="btn-close" data-bs-dismiss="alert"></button>
								   </div>
 

				                   <!-- View -->
				                   <div id="profileView">
				                       <div class="card p-4 shadow-sm profile-card">
				                           <div class="row align-items-center">
				                               <!-- Avatar -->
				                               <div class="col-md-3 text-center">
				                                   <div class="profile-avatar" id="profileInitials">
				                                       <span th:text="${#strings.substring(agent.firstName,0,1) + #strings.substring(agent.lastName,0,1)}">A S</span>
				                                   </div>
				                               </div>

				                               <!-- Info -->
				                               <div class="col-md-9">
				                                   <div class="profile-info">
				                                       <div class="info-box"><strong>Name</strong><span th:text="${agent.firstName + ' ' + agent.lastName}">Agent Name</span></div>
				                                       <div class="info-box"><strong>Email</strong><span th:text="${agent.email}">agent@example.com</span></div>
				                                       <div class="info-box"><strong>Phone</strong><span th:text="${agent.phoneNumber}">+91 9876543210</span></div>
				                                       <div class="info-box"><strong>Address</strong><span th:text="${agent.address}">123 Street</span></div>
				                                       <div class="info-box"><strong>City</strong><span th:text="${agent.city}">City</span></div>
				                                       <div class="info-box"><strong>State</strong><span th:text="${agent.state}">State</span></div>
				                                       <div class="info-box"><strong>Pin Code</strong><span th:text="${agent.pinCode}">123456</span></div>
				                                   </div>

				                                   <!-- Action -->
				                                   <div class="text-end mt-3">
				                                       <button class="btn btn-primary px-4" onclick="toggleEdit(true)">
				                                           <i class="fas fa-edit me-2"></i>Edit Profile
				                                       </button>
				                                   </div>
				                               </div>
				                           </div>
				                       </div>
				                   </div>
                    <!-- Edit Form -->
                    <div id="profileEdit" style="display: none;">
                        <form th:action="@{/agent/web/update-profile}" th:object="${agent}" method="post" class="mt-3">
                            <input type="hidden" th:field="*{id}" />
                            <div class="row g-3">
                                <div class="col-md-6"><label>First Name</label><input type="text" class="form-control" th:field="*{firstName}"></div>
                                <div class="col-md-6"><label>Last Name</label><input type="text" class="form-control" th:field="*{lastName}"></div>
                                <div class="col-md-6"><label>Email</label><input type="email" class="form-control" th:field="*{email}" readonly></div>
                                <div class="col-md-6"><label>Phone</label><input type="text" class="form-control" th:field="*{phoneNumber}"></div>
                                <div class="col-12"><label>Address</label><input type="text" class="form-control" th:field="*{address}"></div>
                                <div class="col-md-4"><label>City</label><input type="text" class="form-control" th:field="*{city}"></div>
                                <div class="col-md-4"><label>State</label><input type="text" class="form-control" th:field="*{state}"></div>
                                <div class="col-md-4"><label>Pin Code</label><input type="text" class="form-control" th:field="*{pinCode}"></div>
                            </div>
                            <div class="mt-3 text-end">
                                <button type="submit" class="btn btn-success">Update Profile</button>
                                <button type="button" class="btn btn-secondary" onclick="toggleEdit(false)">Cancel</button>
                            </div>
                        </form>
                    </div>
                </div>

                <!-- Customers -->
                <div id="customersContent" class="content-section">
                    <h2 class="mb-4">My Customers</h2>
                    <div th:if="${#lists.isEmpty(assignedCustomers)}" class="alert alert-info">No customers assigned yet.</div>
                    <table class="table table-bordered customer-table" th:if="${!#lists.isEmpty(assignedCustomers)}">
                        <thead>
                        <tr>
                            <th>Customer Id</th>
                            <th>Name</th>
                            <th>Email</th>
                            <th>Phone</th>
                            <th>Status</th>
                        </tr>
                        </thead>
                        <tbody>
                        <tr th:each="cust : ${assignedCustomers}">
                            <td th:text="${cust.id}">1</td>
                            <td th:text="${cust.fullName}">John Doe</td>
                            <td th:text="${cust.email}">john@example.com</td>
                            <td th:text="${cust.phoneNumber}">9876543210</td>
                            <td>
                                <span th:text="${cust.isActive ? 'Active' : 'Inactive'}"
                                      th:classappend="${cust.isActive} ? 'badge bg-success' : 'badge bg-danger'">Active</span>
                            </td>
                        </tr>
                        </tbody>
                    </table>
                </div>

                <!-- Create Policy -->
                <div id="createPolicyContent" class="content-section">
                    <h2 class="mb-4">Create Policies</h2>
                    <div class="card text-center shadow-sm p-4">
                        <p class="text-muted">Create new policies for your customers</p>
                        <a th:href="@{/policies/agent}" class="btn btn-gradient px-4 py-2">
                            <i class="fas fa-plus-circle me-2"></i> Create Policy
                        </a>
                    </div>
                </div>

                <!-- Buy Policy -->
                <div id="buyPolicyContent" class="content-section">
                    <h2 class="mb-4">Buy Policies</h2>
                    <div class="card text-center shadow-sm p-4">
                        <p class="text-muted">Purchase policies easily for your customers with just one click.</p>
                        <a th:href="@{/agent/purchase/policies}" class="btn btn-gradient px-4 py-2 mt-2">
                            <i class="fas fa-shopping-cart me-2"></i> Buy Policy
                        </a>
                    </div>
                </div>

                <!-- Payment History -->
                <div id="paymentHistoryContent" class="content-section">
                    <h2 class="mb-4">Payment History</h2>
                    <div class="card text-center shadow-sm p-4">
                        <p class="text-muted">Check the payment history of your customers for purchased policies.</p>
                        <a th:href="@{/history}" class="btn btn-gradient px-4 py-2 mt-2">
                            <i class="fas fa-wallet me-2"></i> View Payment History
                        </a>
                    </div>
                </div>
            </div>
        </div>
    </div>
</div>

<script>
	function toggleEdit(isEdit) {
	    document.getElementById("profileEdit").style.display = isEdit ? "block" : "none";
	    document.getElementById("profileView").style.display = isEdit ? "none" : "block";
	}


    function showSection(id) {
        document.querySelectorAll(".content-section").forEach(sec => sec.classList.remove("active"));
        document.getElementById(id).classList.add("active");
    }

    function updateDate() {
        const now = new Date();
        document.getElementById('currentDateTime').innerText =
            now.toLocaleDateString('en-IN', {
                weekday: 'long',
                year: 'numeric',
                month: 'long',
                day: 'numeric'
            });
    }
    updateDate();
    setInterval(updateDate, 60000 * 60); // refresh every 1 hour
	
	
	    document.addEventListener("DOMContentLoaded", function () {
	        // Read ?success=... from URL
	        const urlParams = new URLSearchParams(window.location.search);
	        const successMessage = urlParams.get("success");

	        if (successMessage) {
	            const msgDiv = document.getElementById("successMessage");
	            msgDiv.textContent = successMessage;
	            msgDiv.style.display = "block";

	            // Auto-hide after 3 seconds
	            setTimeout(() => {
	                msgDiv.style.display = "none";
	            }, 3000);

	            // Clean URL (remove ?success=...)
	            history.replaceState(null, "", window.location.pathname + window.location.hash);
	        }
	    });

</script>

<script src="https://cdnjs.cloudflare.com/ajax/libs/bootstrap/5.3.2/js/bootstrap.bundle.min.js"></script>
</body>
</html>